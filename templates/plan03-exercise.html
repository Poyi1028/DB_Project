<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <title>運動菜單完成</title>
    <link rel="stylesheet" type="text/css" href="/static/css/plan03-exercise.css" />
</head>

<body>
    <div class="header">
<<<<<<< HEAD
        <button onclick="history.back()" class="back-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left"
                viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
=======
        <button onclick="back()" class="back-button">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
>>>>>>> 038b18614b1d989d8405918d3cc7cdaabf3ecb55
            </svg>
            回上頁
        </button>
        <div class="headline">Training List</div>
    </div>
    <div class="container">
        {% for day in range(1, days + 1) %}
<<<<<<< HEAD
        <div class="table-container">
            <div class="day-keyword">Day {{ day }}</div>
            <table>
                <thead>
                    <tr>
                        <th>項目</th>
                        <th>訓練部位</th>
                        <th>磅數 (kg)</th>
                        <th>組數</th>
                    </tr>
                </thead>
                <tbody>
                    {% if day in selected_plan %}
                    {% for exercise in selected_plan[day] %}
                    <tr>
                        <td>{{ exercise.exercise }}</td>
                        <td>{{ exercise.muscle_group }}</td>
                        <td><input type="number" value="12"></td>
                        <td>
                            <input type="number" value="{{ exercise.set_value }}" class="times-input">
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="4">No exercises for this day</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            <div class="button-container">
                <button class="status-button">未完成</button>
=======
            <div class="table-container">
                <div class="day-keyword">Day {{ day }}</div>
                <table>
                    <thead>
                        <tr>
                            <th>Exercise</th>
                            <th>Training Area</th>
                            <th>Weight (kg)</th>
                            <th>Sets</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if day in selected_plan %}
                            {% for exercise in selected_plan[day] %}
                                <tr>
                                    <td>{{ exercise.exercise }}</td>
                                    <td>{{ exercise.muscle_group }}</td>
                                    <td><input type="number" value="12"></td>
                                    <td>
                                        <input type="number" value="{{ exercise.set_value }}" class="times-input">
                                    </td>
                                    <td style="display:none;" class="exercise-status">{{ exercise.status }}</td> <!-- 隱藏狀態信息 -->
                                    <td style="display:none;" class="exercise-status">{{ exercise.plan_id }}</td> <!-- 隱藏狀態信息 -->
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4">No exercises for this day</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
                <div class="button-container">
                    <button class="status-button">未完成</button>
                </div>
>>>>>>> 038b18614b1d989d8405918d3cc7cdaabf3ecb55
            </div>
        </div>
        {% endfor %}
    </div>
    <script>
        function back() {
            window.location.href = "/plan";
        }
        // 初始化按钮状态
        window.addEventListener('DOMContentLoaded', (event) => {
            const statuses = [];
            document.querySelectorAll('.exercise-status').forEach(statusElement => {
                statuses.push(statusElement.textContent.trim());
            });
            
            const button = document.querySelector('.status-button');
            if (statuses.includes('Done')) {
                button.classList.add('completed');
                button.textContent = '已完成';
            }
        });

        document.querySelectorAll('.status-button').forEach(button => {
            button.addEventListener('click', function () {
                if (button.classList.contains('completed')) {
                    button.classList.remove('completed');
                    button.textContent = '未完成';
                } else {
                    button.classList.add('completed');
                    button.textContent = '已完成';

                    // 获取 planid 信息
                    const planIds = [];
                    document.querySelectorAll('.exercise-planid').forEach(planidElement => {
                        planIds.push(planidElement.textContent.trim());
                    });

                    // 调用新的 API
                    fetch('/plan/workout/update', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ planIds: planIds })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        // 成功后跳转到新页面
                        window.location.href = '/plan/workout/update';
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
                }
            });
        });
    </script>
</body>

</html>